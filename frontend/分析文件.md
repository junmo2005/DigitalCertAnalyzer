## 一、文件结构

```
cert/
├── app.py
├── batch_process_pcaps.py
├── certificate_chain_validator.py
├── certificate_fecher.py
├── certificate_filter.py
├── certificate_security_enhancer.py
├── certificate_validity_analyzer.py
├── domain_saver.py
├── http_security_checker.py
├── test_certificate_analysis.py
├── tls_certificate_filter.py
├── certificate_checker.py
├── README.md
├── routes/                   # 路由模块目录
│   ├── __init__.py
│   ├── main_routes.py       # 主页面和介绍页面路由
│   ├── cert_routes.py       # 证书分析相关路由
│   ├── security_routes.py   # 安全分析相关路由
│   └── report_routes.py     # 报告相关路由
├── utils/                   # 通用工具函数模块
│   ├── __init__.py
│   ├── logging_utils.py     # 日志配置
│   ├── file_utils.py        # 文件处理工具
│   ├── report_utils.py      # 报告生成工具（证书分析相关数据格式化）
│   └── security_utils.py    # 安全分析工具函数
├── services/                # 业务逻辑服务
│   ├── __init__.py
│   ├── task_queue.py        #创建任务队列系统
│   ├── 
│   └── deepseek_service.py  # DeepSeek API服务
├── static/
│   ├── css/
│   │   ├── style.css           # 通用样式
│   │   ├── security.css        # 安全分析页面专用样式
│   │   └── cert_analysis.css   # 证书分析页面专用样式
│   │   └──index.css            #主页面专用样式
│   │   └──style.css            #通用样式
│   │   └──system_intro.css     #系统介绍页面专用样式
│   │   └──all.min.css
│   │   └──bootstrap.min.css
│   ├── js/
│   │   ├── cert_analysis.js
│   │   ├── security.js         #添加了异步报告生成系统
│   │   └── utils.js            #通用工具
│   │   └──all.min.js
│   │   └── bootstrap.bundle.min.js
│   │   └── chart.js
│   │   └── marked.min.js
│   ├── webfonts/               #字体
│   └── images/
└── templates/
    ├── index.html
    ├── cert_analysis.html
    ├── security_analysis.html   # 合并后的安全分析页面
    └── system_intro.html
```



## 二、后端文件

###  **1. batch_process_pcaps.py**

作用：主入口脚本，用于批量处理 PCAP 文件并分析提取出的证书。

功能：

调用 extract_certificates_from_pcap 从 PCAP 中提取证书。

调用 CertificateValidityAnalyzer 分析证书有效性。

支持命令行参数指定证书目录和过期预警天数。

生成分析报告（JSON 格式）和图表数据。

适用场景：

批量处理多个 PCAP 文件或证书目录。

自动化证书提取与分析流程。

###  **2. certificate_filter.py**

作用：从 PCAP 文件中提取 TLS 握手阶段的 Certificate 消息，并解析证书链信息。

功能：

使用 dpkt 和 scapy 解析 PCAP。

提取 TLS 握手记录中的证书数据。

支持 TLS 1.2 和 TLS 1.3 的证书格式。

统计证书出现次数、去重、保存证书链信息。

支持 tshark 作为备选提取工具。

适用场景：

需要详细分析 TLS 证书链和重复证书的情况。

研究证书在流量中的分布和重复使用情况。

###   3.certificate_validity_analyzer.py

作用：分析证书的有效性、加密强度、颁发机构等信息。

功能：

解析证书文件（DER/PEM 格式）。

检查证书是否过期、即将过期。

分析加密算法（RSA/ECC 强度）。

统计 SAN（Subject Alternative Name）、通配符证书、密钥用途等。

支持证书去重（基于 SHA256 哈希）。

适用场景：

对提取出的证书进行详细有效性分析。

生成证书健康度报告和统计图表。

###  4.tls_certificate_filter.py

作用：使用 dpkt 解析 PCAP 并提取 TLS 证书。
价值：纯 Python 实现，不依赖 tshark，适合轻量级或受限环境。

###  5.test_certificate_analysis.py

作用：演示完整的证书分析流程（提取 + 分析）。
价值：集成测试脚本，可用于验证整个工具链是否正常工作。

### 6.**certificate_fetcher.py** 

 用于从域名获取真实证书

### 7.**http_security_checker.py**

 用于检查HTTP安全头

### 8.**certificate_chain_validator.py**

 -用于验证证书链完整性

### **9.certificate_security_enhancer.py**

 核心协调器 - 整合所有安全分析功能

业务逻辑层 - 提供高级安全分析接口

数据聚合器 - 生成综合安全报告

配置管理器 - 管理证书钉扎等配置   



## 三、整体工作流程：



```
PCAP 文件
    ↓
 certificate_filter.py（提取保存所有分割好的PCAP文件里的证书）
    ↓
提取证书（.der/.pem）
    ↓
certificate_validity_analyzer.py
    ↓
分析证书有效性、加密强度、颁发者等
    ↓
batch_process_pcaps.py
    ↓
生成报告 + 图表
```

```
certificate_security_enhancer.py (主协调器)
    │
    ├── certificate_fetcher.py (获取证书数据)
    │
    ├── http_security_checker.py (检查HTTP安全)
    │
    └── certificate_chain_validator.py (验证证书链)
```



##  四、使用流程：

- **1.打开终端，激活虚拟环境    venv\Scripts\activate**
- **2.使用命令  python certificate_filter.py sample.pcap 提取证书到文件夹里**
- **3.将所有证书打包成压缩包**
- **4.运行python app.py**
- **5.打开网址，分析证书**
- **6.ctrl+c,关掉系统，退出虚拟环境“deactivate”**

**(conda)?使用pip命令时要用这样的形式 python -m pip install tqdm**



## 五、常规操作

### 1.创建虚拟空间（python原生）

```
#创建目录，打开目录
mkdir myproject
cd myproject

# 创建虚拟环境（推荐使用Python3.x）
python -m venv myenv（myenv是虚拟环境名称）

#激活
# Windows
myenv\Scripts\activate
# Linux/Mac
source myenv/bin/activate

#  安装依赖
pip install numpy pandas flask（例子）

# 生成requirements.txt
pip freeze > requirements.txt

#  退出环境
deactivate

# 安装项目依赖
pip install -r requirements.txt


```

### 2.创建虚拟空间（Conda——推荐）

**本机已安装了Anaconda(终端前有bash标识) “康达”**

```
创建一个名为 my_env 的新环境，并指定Python版本（例如3.10）
conda create -n my_env python=3.10

激活该环境
conda activate my_env

在新环境中安装包 (例如安装pandas)
conda install pandas
或者也可以使用pip，但建议优先用conda
pip install pandas

查看所有环境变量（先激活）
  在Windows PowerShell中
Get-ChildItem Env:  或者 ls Env:
  在Windows命令提示符中（先激活）
  set
 或者直接使用conda命令  
 #查看当前环境        #查看所有Conda环境及其路径      #查看当前激活的环境
 conda info         conda env list               conda info --envs
退出环境
conda deactivate

删除环境
conda remove -n my_env --all
```

**环境隔离性更好**

```
# 不好的做法：环境在项目外部
/home/user/venvs/myproject_venv
/home/user/projects/myproject

# 好的做法：环境在项目内部
/home/user/projects/myproject/venv
/home/user/projects/myproject/src
```

